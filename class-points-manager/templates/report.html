{% extends "base.html" %}

{% block title %}å®¶æ ¡åˆä½œ - æ¡£æ¡ˆç®¡ç†{% endblock %}

{% block content %}
<style>
    /* === é¡µé¢åŸºç¡€æ ·å¼ === */
    .report-container { max-width: 1300px; margin: 0 auto; }
    
    /* ç­›é€‰å·¥å…·æ  */
    .filter-bar {
        background: white;
        padding: 20px 30px;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        margin-bottom: 25px;
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
        border: 1px solid #f1f5f9;
    }

    .filter-item { display: flex; align-items: center; gap: 10px; }
    .filter-label { font-weight: 600; color: #64748b; font-size: 14px; }
    .filter-select {
        padding: 10px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        color: #334155;
        background: #f8fafc;
        cursor: pointer;
        min-width: 160px;
    }
    .filter-select:focus { border-color: #6366f1; outline: none; background: white; }

    /* å­¦ç”Ÿåˆ—è¡¨å¡ç‰‡ */
    .student-list-card { 
        background: white; 
        border-radius: 24px; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
        overflow: hidden; 
        border: 1px solid #f1f5f9;
    }
    
    .student-table { width: 100%; border-collapse: collapse; }
    .student-table th { 
        background: #f8fafc; padding: 18px 30px; text-align: left; 
        color: #64748b; font-weight: 700; font-size: 13px; text-transform: uppercase; 
    }
    .student-table td { 
        padding: 18px 30px; border-bottom: 1px solid #edf2f7; 
        vertical-align: middle; color: #334155; 
    }
    .student-table tr:hover { background: #fdfdfd; }

    /* è¯„ä»·å±•ç¤ºæ ·å¼ */
    .eval-display {
        font-size: 14px;
        color: #475569;
        background: #f8fafc;
        padding: 8px 12px;
        border-radius: 8px;
        border-left: 3px solid #cbd5e1;
        max-width: 100%; /* é€‚åº”çˆ¶å®¹å™¨ */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .eval-display.has-content { border-left-color: #6366f1; background: #eef2ff; color: #1e293b; }
    
    /* æŒ‰é’® */
    .btn-action {
        display: inline-flex; align-items: center; justify-content: center; gap: 4px;
        padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600;
        cursor: pointer; border: 1px solid #e2e8f0; transition: all 0.2s; white-space: nowrap;
    }
    .btn-card { background: #6366f1; color: white; border-color: #6366f1; box-shadow: 0 2px 5px rgba(99, 102, 241, 0.3); }
    .btn-card:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4); }

    /* === æ¨¡æ€æ¡†é€šç”¨ === */
    .custom-modal {
        display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
        background: rgba(0,0,0,0.6); /* åŠ æ·±é®ç½©é¢œè‰² */
        z-index: 2000; /* æé«˜å±‚çº§ */
        align-items: center; justify-content: center; 
        /* ç§»é™¤ backdrop-filter ä»¥é˜²æ¸²æŸ“å¼‚å¸¸ */
    }

    /* === å¯„è¯­æ¨¡æ€æ¡† === */
    .eval-box { 
        background: #ffffff; /* ç¡®ä¿çº¯ç™½èƒŒæ™¯ */
        border-radius: 20px; 
        width: 90%; 
        max-width: 500px; 
        padding: 30px; 
        box-shadow: 0 25px 50px rgba(0,0,0,0.3); 
        position: relative; /* ç¡®ä¿å®šä½ä¸Šä¸‹æ–‡ */
        z-index: 2001;
    }

    /* === æ¡£æ¡ˆå¡ (æ ¸å¿ƒè®¾è®¡) === */
    .archive-card {
        background: #ffffff; width: 850px; max-width: 95%; border-radius: 24px;
        overflow: hidden; box-shadow: 0 30px 60px rgba(0,0,0,0.4);
        display: flex; flex-direction: column;
        position: relative;
        z-index: 2001;
    }

    .archive-header {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        padding: 30px 40px; color: white; display: flex; justify-content: space-between; align-items: center;
    }

    .archive-body { padding: 40px; display: flex; gap: 40px; }
    
    .archive-left { width: 280px; border-right: 1px solid #f1f5f9; padding-right: 40px; text-align: center; }
    .archive-avatar {
        width: 100px; height: 100px; border-radius: 50%; background: #eef2ff; color: #6366f1;
        font-size: 40px; display: flex; align-items: center; justify-content: center; font-weight: 800;
        margin: 0 auto 20px; border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .archive-right { flex: 1; }
    
    /* ç§¯åˆ†èƒ½åŠ›æ¡ */
    .stat-bar-group { margin-bottom: 25px; }
    .stat-bar-label { display: flex; justify-content: space-between; font-size: 13px; color: #64748b; margin-bottom: 5px; }
    .stat-bar-bg { height: 10px; background: #f1f5f9; border-radius: 5px; overflow: hidden; }
    .stat-bar-fill { height: 100%; border-radius: 5px; transition: width 1s ease; }

    .comment-box {
        background: #fffbeb; border: 1px solid #fcd34d; border-radius: 16px; padding: 25px;
        position: relative; margin-top: 20px;
    }
    .comment-tag {
        position: absolute; top: -12px; left: 20px; background: #f59e0b; color: white;
        padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;
    }

    /* å“åº”å¼é€‚é… */
    @media (max-width: 768px) {
        .filter-bar { 
            padding: 10px 0; 
            background: transparent !important; 
            box-shadow: none !important;
            border: none !important;
            flex-direction: column !important; 
            align-items: stretch !important; 
            gap: 10px; 
        }
        
        .filter-item { 
            background: white;
            padding: 12px 15px;
            border-radius: 14px;
            border: 1px solid #edf2f7;
            display: flex;
            flex-direction: column; 
            align-items: flex-start !important; 
            gap: 6px !important;
            width: 100% !important;
        }
        
        .filter-label { font-size: 12px; color: #94a3b8; font-weight: 700; }
        
        .filter-select { 
            width: 100% !important; 
            border: none !important;
            padding: 0 !important;
            background: transparent !important;
            height: 30px;
            font-weight: 700;
            color: #1e293b;
        }

        /* ä¸“é—¨å¤„ç†æ—¥æœŸ */
        .filter-item:has(input[type="date"]) {
            flex-direction: row !important;
            flex-wrap: wrap;
            align-items: center !important;
        }
        
        #startDate, #endDate {
            width: calc(50% - 15px) !important;
            border-bottom: 2px solid #f1f5f9 !important;
            border-radius: 0;
        }
        
        .btn-action { 
            width: 100%; 
            height: 48px; 
            font-size: 15px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        
        .student-list-card { border-radius: 18px; border: 1px solid #f1f5f9; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .student-table { display: block; overflow-x: auto; }
        
        .archive-card { border-radius: 0; width: 100%; height: 100%; }
        .archive-header { padding: 25px 20px; }
        .archive-header h1 { font-size: 24px !important; }
        .archive-body { flex-direction: column; padding: 25px 20px; gap: 20px; }
        .archive-left { width: 100%; border-right: none; border-bottom: 1px solid #f1f5f9; padding-right: 0; padding-bottom: 20px; }
    }
</style>

<div class="report-container">
    <!-- ç­›é€‰å·¥å…·æ  -->
    <div class="filter-bar">
        <div class="filter-item">
            <span class="filter-label">ç­çº§</span>
            <select id="classSelect" class="filter-select" onchange="loadData()">
                <option value="">åŠ è½½ä¸­...</option>
            </select>
        </div>
        
        <div class="filter-item" style="gap: 5px;">
            <span class="filter-label">æ—¶é—´æ®µ</span>
            <input type="date" id="startDate" class="filter-select" style="width: 130px;" onchange="loadData()">
            <span style="color:#cbd5e1">-</span>
            <input type="date" id="endDate" class="filter-select" style="width: 130px;" onchange="loadData()">
            <button class="btn-action" style="background:#f1f5f9; padding:8px 12px; color:#64748b;" onclick="setThisMonth()">æœ¬æœˆ</button>
        </div>

        <div class="filter-item">
            <span class="filter-label">è¯„ä»·ç±»å‹</span>
            <div style="position: relative;">
                <input type="text" id="tagInput" class="filter-select" list="tagOptions" placeholder="é€‰æ‹©æˆ–è¾“å…¥..." onchange="loadData()" style="width: 140px;">
                <datalist id="tagOptions">
                    <option value="æœˆåº¦è¯„ä»·">
                    <option value="æœŸä¸­æ€»ç»“">
                    <option value="æœŸæœ«æ€»è¯„">
                    <option value="å®¶é•¿ä¼šåé¦ˆ">
                    <option value="æ—¥å¸¸å¯„è¯­">
                </datalist>
            </div>
        </div>
        
        <div style="flex: 1; text-align: right;">
            <button class="btn-action" style="background: #10b981; color: white;" onclick="exportCurrentView()">
                <i class="fas fa-download"></i> å¯¼å‡ºå½“å‰æŠ¥è¡¨
            </button>
        </div>
    </div>

    <!-- ä¸»åˆ—è¡¨ -->
    <div class="student-list-card">
        <table class="student-table">
            <thead>
                <tr>
                    <th>å­¦ç”Ÿä¿¡æ¯</th>
                    <th>æœ¬æœŸç§¯åˆ†å˜åŠ¨</th>
                    <th style="width: 45%;">æœ¬æœŸå¯„è¯­</th>
                    <th style="width: 180px;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="reportListBody">
                <!-- JS ç”Ÿæˆ -->
            </tbody>
        </table>
    </div>
</div>

<!-- å†™å¯„è¯­æ¨¡æ€æ¡† -->
<div id="evalModal" class="custom-modal">
    <div class="eval-box">
        <h3 style="margin-top: 0; color: #1e293b;">âœï¸ å†™å¯„è¯­</h3>
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-size: 13px; color: #64748b; margin-bottom: 5px;">è¯„ä»·ç±»å‹</label>
            <input type="text" id="evalTagInputModal" class="filter-select" list="tagOptions" style="width: 100%; box-sizing: border-box;" placeholder="é€‰æ‹©æˆ–è¾“å…¥è‡ªå®šä¹‰ç±»å‹...">
        </div>

        <textarea id="evalContentInput" class="form-control" style="height: 120px; margin-bottom: 20px; padding: 15px; border-radius: 12px; border: 2px solid #e2e8f0; resize: none;" placeholder="è¯·è¾“å…¥å¯¹å­¦ç”Ÿçš„è¯„ä»·..."></textarea>
        
        <div style="display: flex; gap: 10px;">
            <button class="btn" style="flex: 1; border-radius: 10px; background: #f1f5f9; color: #64748b;" onclick="closeEvalModal()">å–æ¶ˆ</button>
            <button class="btn" style="flex: 1; border-radius: 10px; background: #6366f1; color: white;" onclick="saveEvaluation()">ä¿å­˜</button>
        </div>
    </div>
</div>

<!-- æ¡£æ¡ˆå¡é¢„è§ˆæ¨¡æ€æ¡† -->
<div id="archiveModal" class="custom-modal" style="padding-top: 20px; overflow-y: auto;">
    <div class="archive-card">
        <div class="archive-header">
            <div>
                <h2 style="margin: 0; font-weight: 800; font-size: 24px;">å­¦ç”Ÿæˆé•¿æ¡£æ¡ˆ</h2>
                <div style="opacity: 0.8; font-size: 14px; margin-top: 5px;" id="archivePeriod">2025-12</div>
            </div>
            <div style="font-family: 'Times New Roman', serif; font-size: 20px; font-weight: bold; opacity: 0.3;">
                REPORT CARD
            </div>
        </div>
        
        <div class="archive-body">
            <!-- å·¦ä¾§ï¼šåŸºç¡€ä¿¡æ¯ -->
            <div class="archive-left">
                <div class="archive-avatar" id="archiveAvatar">A</div>
                <h2 id="archiveName" style="color: #1e293b; margin-bottom: 5px;">å§“å</h2>
                <p id="archiveId" style="color: #64748b; font-size: 14px; margin-bottom: 30px;">å­¦å·</p>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 16px;">
                    <div style="font-size: 13px; color: #64748b;">æœ¬æœŸæ€»ç§¯åˆ†</div>
                    <div id="archiveTotalPoints" style="font-size: 32px; font-weight: 800; color: #6366f1; margin-top: 5px;">0</div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šè¯¦æƒ… -->
            <div class="archive-right">
                <h4 style="margin: 0 0 20px 0; color: #475569;">ğŸ“Š è¡¨ç°åˆ†æ</h4>
                <div id="archiveStatsList">
                    <!-- åŠ¨æ€ç”Ÿæˆç§¯åˆ†æ¡ -->
                </div>
                
                <div class="comment-box">
                    <div class="comment-tag" id="archiveTag">è¯„è¯­</div>
                    <p id="archiveComment" style="margin: 0; color: #4b5563; line-height: 1.6;">
                        æš‚æ— è¯„è¯­
                    </p>
                    <div style="text-align: right; margin-top: 15px; color: #d97706; font-size: 13px; font-weight: 600;">
                        â€” ç­ä¸»ä»»å¯„è¯­
                    </div>
                </div>
            </div>
        </div>
        
        <div style="padding: 20px; background: #f8fafc; border-top: 1px solid #f1f5f9; text-align: right;">
            <button class="btn" onclick="closeArchiveModal()" style="background: white; border: 1px solid #cbd5e0; border-radius: 8px;">å…³é—­</button>
            <button class="btn" onclick="window.print()" style="background: #4f46e5; color: white; border-radius: 8px; margin-left: 10px;">
                <i class="fas fa-print"></i> æ‰“å°æ¡£æ¡ˆ
            </button>
        </div>
    </div>
</div>

<script>
    let currentStudentId = null;
    let currentClassData = [];

    document.addEventListener('DOMContentLoaded', () => {
        loadClasses();
        setThisMonth(); // é»˜è®¤é€‰ä¸­æœ¬æœˆ
    });

    function setThisMonth() {
        const now = new Date();
        const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
        const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        
        document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
        document.getElementById('endDate').value = new Date().toISOString().split('T')[0]; // ç»“æŸæ—¥æœŸé»˜è®¤ä¸ºä»Šå¤©ï¼Œæ–¹ä¾¿æŸ¥çœ‹å®æ—¶æ•°æ®
        
        loadData();
    }

    async function loadClasses() {
        const res = await fetch('/api/classes');
        const classes = await res.json();
        const select = document.getElementById('classSelect');
        select.innerHTML = '';
        classes.forEach(c => {
            select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
        });
        if(classes.length) {
            select.value = classes[0].id;
            loadData();
        }
    }

    async function loadData() {
        const classId = document.getElementById('classSelect').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const tag = document.getElementById('tagInput').value.trim();
        
        if(!classId) return;

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        const tbody = document.getElementById('reportListBody');
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 40px; color: #a0aec0;">æ­£åœ¨åŠ è½½æ•°æ®...</td></tr>';

        try {
            // 1. è·å–æ‰€æœ‰å­¦ç”Ÿ
            const sRes = await fetch(`/api/classes/${classId}/students`);
            const students = await sRes.json();
            currentClassData = students;

            // 2. å¹¶è¡Œè·å–æ‰€æœ‰è¯¦æƒ…æ•°æ® (å…³é”®ä¼˜åŒ–)
            const promises = students.map(async s => {
                // è¯„ä»·è¯·æ±‚
                let evalUrl = `/api/students/${s.id}/evaluation?`;
                if(startDate) evalUrl += `start_date=${startDate}`;
                if(endDate) evalUrl += `&end_date=${endDate}`;
                if(tag) evalUrl += `&tag=${encodeURIComponent(tag)}`;
                
                // ç»Ÿè®¡è¯·æ±‚
                let statsUrl = `/api/students/${s.id}/stats_detail?`;
                if(startDate) statsUrl += `start_date=${startDate}`;
                if(endDate) statsUrl += `&end_date=${endDate}`;

                const [eRes, stRes] = await Promise.all([
                    fetch(evalUrl),
                    fetch(statsUrl)
                ]);

                const evals = await eRes.json();
                const stats = await stRes.json();

                // ç»‘å®šæ•°æ®åˆ°å¯¹è±¡ä¸Šï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨
                s.cachedEval = evals.length > 0 ? evals[0] : null;
                s.cachedStats = stats;
                
                return s; // è¿”å›å¤„ç†å¥½çš„å­¦ç”Ÿå¯¹è±¡
            });

            // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
            await Promise.all(promises);

            // 3. ä¸€æ¬¡æ€§æ¸²æŸ“
            tbody.innerHTML = ''; // æ¸…ç©ºåŠ è½½æç¤º
            
            students.forEach(s => {
                const tr = document.createElement('tr');
                const evalData = s.cachedEval;
                
                const evalHtml = evalData 
                    ? `<div class="eval-display has-content">
                         <span class="eval-tag">${evalData.tag || 'å¯„è¯­'}</span>${evalData.content}
                       </div>`
                    : `<div class="eval-display">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å¯„è¯­</div>`;

                const scoreChange = s.cachedStats.period_total || 0;
                const scoreColor = scoreChange >= 0 ? '#10b981' : '#ef4444';
                const scoreSign = scoreChange > 0 ? '+' : '';

                tr.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 40px; height: 40px; background: #e0e7ff; color: #6366f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800;">
                                ${s.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 700; color: #1e293b;">${s.name}</div>
                                <div style="font-size: 12px; color: #94a3b8;">${s.student_id}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style="font-weight: 800; font-size: 16px; color: ${scoreColor};">
                            ${scoreSign}${scoreChange}
                        </span>
                    </td>
                    <td>${evalHtml}</td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-action" style="background: white; border: 1px solid #e2e8f0;" onclick="openEvalModal(${s.id})">
                                <i class="fas fa-pen"></i> å†™å¯„è¯­
                            </button>
                            <button class="btn-action btn-card" onclick="openArchiveModal(${s.id}, ${scoreChange})">
                                æ¡£æ¡ˆå¡
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });

        } catch (e) {
            console.error(e);
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color: red;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
        }
    }

    // === å¯„è¯­ ===
    function openEvalModal(id) {
        currentStudentId = id;
        document.getElementById('evalContentInput').value = '';
        document.getElementById('evalModal').style.display = 'flex';
        
        // è‡ªåŠ¨å¡«å…¥å½“å‰ç­›é€‰çš„tagï¼Œå¦‚æœæ²¡æœ‰åˆ™ç•™ç©ºè®©ç”¨æˆ·é€‰
        const currentTag = document.getElementById('tagInput').value.trim();
        document.getElementById('evalTagInputModal').value = currentTag || ''; 
    }

    function closeEvalModal() { document.getElementById('evalModal').style.display = 'none'; }

    async function saveEvaluation() {
        const content = document.getElementById('evalContentInput').value;
        const tag = document.getElementById('evalTagInputModal').value.trim() || 'æ—¥å¸¸å¯„è¯­';
        
        // ä½¿ç”¨å½“å‰çœŸå®æ—¥æœŸä½œä¸ºè®°å½•æ—¥æœŸ
        const today = new Date().toISOString().split('T')[0];

        if(!content) return alert("è¯·å¡«å†™å†…å®¹");

        await fetch(`/api/students/${currentStudentId}/evaluation`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ 
                content, 
                tag,
                period: today 
            })
        });
        
        closeEvalModal();
        loadData(); // åˆ·æ–°åˆ—è¡¨
    }

    // === æ¡£æ¡ˆå¡ ===
    function openArchiveModal(studentId, totalScore) {
        const student = currentClassData.find(s => s.id === studentId);
        const start = document.getElementById('startDate').value;
        const end = document.getElementById('endDate').value;
        const periodStr = (start && end) ? `${start} è‡³ ${end}` : "å…¨éƒ¨æ—¶é—´";
        
        document.getElementById('archiveAvatar').textContent = student.name.charAt(0);
        document.getElementById('archiveName').textContent = student.name;
        document.getElementById('archiveId').textContent = student.student_id;
        document.getElementById('archivePeriod').textContent = `ç»Ÿè®¡å‘¨æœŸ: ${periodStr}`;
        document.getElementById('archiveTotalPoints').textContent = (totalScore > 0 ? '+' : '') + totalScore;
        
        // å¡«å……å¯„è¯­
        const evalData = student.cachedEval;
        if(evalData) {
            document.getElementById('archiveTag').textContent = evalData.tag;
            document.getElementById('archiveComment').textContent = evalData.content;
        } else {
            document.getElementById('archiveTag').textContent = "æç¤º";
            document.getElementById('archiveComment').textContent = "è¯¥æ—¶é—´æ®µå†…æš‚æ— è€å¸ˆå¯„è¯­ã€‚";
        }
        
        // å¡«å……èƒ½åŠ›æ¡
        const statsList = document.getElementById('archiveStatsList');
        statsList.innerHTML = '';
        const details = student.cachedStats.details || []; 
        
        if(details.length === 0) {
            statsList.innerHTML = '<div style="color:#94a3b8; font-size:13px;">æœ¬å‘¨æœŸæš‚æ— ç§¯åˆ†è®°å½•</div>';
        } else {
            // å–å‰4ä¸ª
            details.slice(0, 4).forEach(d => {
                const percent = Math.min(Math.abs(d.total_change) * 5, 100); 
                const color = d.total_change > 0 ? '#10b981' : '#ef4444';
                
                statsList.innerHTML += `
                    <div class="stat-bar-group">
                        <div class="stat-bar-label">
                            <span>${d.reason}</span>
                            <span style="font-weight:700; color:${color}">${d.total_change > 0 ? '+' : ''}${d.total_change}</span>
                        </div>
                        <div class="stat-bar-bg">
                            <div class="stat-bar-fill" style="width: ${percent}%; background: ${color}"></div>
                        </div>
                    </div>
                `;
            });
        }

        document.getElementById('archiveModal').style.display = 'flex';
    }

    function closeArchiveModal() { document.getElementById('archiveModal').style.display = 'none'; }
    
    // ç‚¹å‡»é®ç½©å…³é—­
    window.onclick = function(event) {
        if (event.target.classList.contains('custom-modal')) {
            event.target.style.display = "none";
        }
    }
</script>
{% endblock %}