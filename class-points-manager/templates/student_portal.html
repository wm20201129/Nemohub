<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡ªåŠ©ç”³æŠ¥ä¸­å¿ƒ - ç§¯åˆ†ç³»ç»Ÿ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+SC:wght@400;700;900&display=swap');

        :root {
            --primary: #4f46e5; 
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            --bg: #f8fafc;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --radius-lg: 20px;
            --radius-md: 16px;
        }

        body { 
            margin: 0; font-family: 'Inter', 'Noto Sans SC', system-ui, sans-serif; 
            background: var(--bg); color: var(--text-main); padding-bottom: 40px; line-height: 1.5;
        }
        
        .header { 
            background: white; padding: 16px 24px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 20px; font-weight: 800; color: var(--primary); margin:0; }

        .container { padding: 10px 20px; max-width: 1000px; margin: 0 auto; }

        .section-title { font-size: 18px; font-weight: 800; margin: 25px 0 15px; display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: ''; width: 6px; height: 18px; background: var(--primary-gradient); border-radius: 4px; }

        /* æˆ˜é˜Ÿï¼šç²¾è‡´å°å—ç½‘æ ¼ */
        .group-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 12px; 
        }
        .group-block { 
            background: white; border-radius: 16px; padding: 15px 10px; text-align: center; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.04); border-top: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        .group-block:hover { transform: translateY(-3px); }
        .group-block div:nth-child(1) { font-size: 18px; font-weight: 900; margin-bottom: 4px; color: var(--primary); }
        .group-block div:nth-child(2) { font-size: 14px; font-weight: 800; opacity: 0.6; }

        /* æ‚¬èµï¼šè‡ªé€‚åº”å°å—ç½‘æ ¼ */
        .bounty-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
            gap: 15px; 
        }
        .bounty-card { 
            background: white; border-radius: 16px; padding: 15px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.04); 
            border: 1px solid #f1f5f9;
        }
        
        .leader-item { display:flex; justify-content:space-between; font-size:13px; margin-bottom:5px; padding:6px 10px; border-radius:10px; font-weight:800; background: #f8fafc; }

        .portal-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 30px; 
            background: white; padding: 15px; border-radius: var(--radius-lg); box-shadow: 0 10px 25px rgba(0,0,0,0.08); 
        }
        .menu-card { text-align: center; cursor: pointer; }
        .menu-icon { width: 50px; height: 50px; border-radius: 15px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-size: 22px; color: white; }
        .menu-name { font-weight: 800; font-size: 13px; color: var(--text-muted); }

        /* æ¨¡æ€æ¡†æ ·å¼ - ä¿æŒæœ€ç¨³çš„ç‰ˆæœ¬ */
        .modal-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: flex-end; }
        .modal-body { background: white; width: 100%; border-radius: 30px 30px 0 0; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-content { padding: 20px 25px 40px; }
        .form-group { margin-bottom: 15px; }
        select, input { width: 100%; padding: 12px; border: 2px solid #f1f5f9; border-radius: 12px; font-size: 15px; box-sizing: border-box; }
        .select-list { border: 2px solid #f1f5f9; border-radius: 16px; max-height: 200px; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 8px; }
        .list-item { padding: 10px 5px; text-align: center; border-radius: 10px; background: #f8fafc; font-size: 13px; font-weight: 700; cursor: pointer; border: 1px solid transparent; }
        .list-item.selected { background: #eef2ff; border-color: var(--primary); color: var(--primary); }
        .role-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .role-tag { background: #f1f5f9; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 800; cursor: pointer; color: var(--text-muted); }
        .role-tag.active { background: #eef2ff; color: var(--primary); border: 1px solid var(--primary); }
        .btn-submit { width: 100%; padding: 16px; border: none; border-radius: 18px; font-size: 16px; font-weight: 900; color: white; cursor: pointer; background: var(--primary); }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 30px; border-radius: 30px; font-size: 14px; z-index: 2000; display: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-bolt"></i> èµ›å­£å®å†µä¸­å¿ƒ</h1>
        <a href="/login" style="text-decoration:none; font-size:14px; font-weight:800; color:var(--text-muted);">è¿”å›ç™»å½•</a>
    </div>
    
    <div class="container">
        <div class="section-title">ğŸ”¥ æˆ˜é˜Ÿå®åŠ›æ’è¡Œæ¦œ</div>
        <div id="groupProgressList" class="group-grid"></div>

        <div class="section-title">èµ›å­£æ‚¬èµ Â· å®æ—¶æˆ˜å†µ</div>
        <div id="bountyListContainer" class="bounty-grid"></div>

        <div class="section-title">å­¦ç”Ÿæäº¤å…¥å£</div>
        <div class="portal-grid">
            <div class="menu-card" onclick="openApplyModal('å­¦ä¸šç®¡ç†')">
                <div class="menu-icon" style="background:#6366f1;"><i class="fas fa-book"></i></div>
                <div class="menu-name">å­¦ä¸š</div>
            </div>
            <div class="menu-card" onclick="openApplyModal('ç­çº§ç®¡ç†')">
                <div class="menu-icon" style="background:#f59e0b;"><i class="fas fa-tasks"></i></div>
                <div class="menu-name">æ—¥å¸¸</div>
            </div>
            <div class="menu-card" onclick="openApplyModal('æ´»åŠ¨ç®¡ç†')">
                <div class="menu-icon" style="background:#10b981;"><i class="fas fa-trophy"></i></div>
                <div class="menu-name">è£èª‰</div>
            </div>
            <div class="menu-card" onclick="openApplyModal('è‡ªå®šä¹‰')">
                <div class="menu-icon" style="background:#ec4899;"><i class="fas fa-fingerprint"></i></div>
                <div class="menu-name">æ‰‹åŠ¨</div>
            </div>
            <div class="menu-card" onclick="openQueryModal()">
                <div class="menu-icon" style="background:#64748b;"><i class="fas fa-search"></i></div>
                <div class="menu-name">æŸ¥è¯¢</div>
            </div>
        </div>
    </div>

    <!-- ç”³æŠ¥æ¨¡æ€æ¡† -->
    <div id="applyModal" class="modal-mask">
        <div class="modal-body">
            <div class="modal-header">
                <h3 id="modalTitle" style="margin:0; font-weight:900;">ç”³æŠ¥è¯¦æƒ…</h3>
                <i class="fas fa-times-circle" style="font-size:24px; color:#ccc; cursor:pointer;" onclick="closeApplyModal()"></i>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label>1. ç”³æŠ¥å¯¹è±¡</label>
                    <div style="display:flex; gap:5px; background:#f1f5f9; padding:4px; border-radius:10px; margin-bottom:10px;">
                        <button id="tabStu" style="flex:1; border:none; padding:8px; border-radius:8px; font-weight:800;" onclick="switchTab('student')">é€‰åŒå­¦</button>
                        <button id="tabGrp" style="flex:1; border:none; padding:8px; border-radius:8px; font-weight:800;" onclick="switchTab('group')">é€‰å°ç»„</button>
                    </div>
                    <div id="targetList" class="select-list"></div>
                </div>
                <div id="standardSection">
                    <div class="form-group"><label>2. é¡¹ç›®åˆ†ç±»</label><select id="catSelect" onchange="loadItems()"></select></div>
                    <div class="form-group"><label>3. å…·ä½“äº‹é¡¹</label><select id="itemSelect"></select></div>
                </div>
                <!-- å·²ç§»é™¤æ—§ç‰ˆè‡ªå®šä¹‰è¾“å…¥æ¡†ï¼Œå…¨é¢å¯ç”¨æ ‡å‡†åŒ–é€‰æ‹© -->
                <div class="form-group"><label>4. ç”³æŠ¥æ—¥æœŸ</label><input type="date" id="applyDate"></div>
                <div class="form-group">
                    <label>5. ç”³æŠ¥äººå§“å</label>
                    <input type="text" id="submitterName" placeholder="å¡«å†™å§“å">
                    <div class="role-tags">
                        <span class="role-tag" onclick="quickFill('ç­é•¿', this)">ç­é•¿</span>
                        <span class="role-tag" onclick="quickFill('å­¦ä¹ å§”å‘˜', this)">å­¦å§”</span>
                        <span class="role-tag" onclick="quickFill('è¯¾ä»£è¡¨', this)">è¯¾ä»£è¡¨</span>
                        <span class="role-tag" onclick="quickFill('æœ¬äºº', this)">æœ¬äºº</span>
                    </div>
                </div>
                <button class="btn-submit" onclick="submitApply()">ç¡®è®¤æäº¤å®¡æ ¸</button>
            </div>
        </div>
    </div>

    <!-- æŸ¥è¯¢æ¨¡æ€æ¡† -->
    <div id="queryModal" class="modal-mask">
        <div class="modal-body">
            <div class="modal-header"><h3>ç§¯åˆ†æ¡£æ¡ˆæŸ¥è¯¢</h3><i class="fas fa-times-circle" style="font-size:24px; color:#ccc; cursor:pointer;" onclick="closeQueryModal()"></i></div>
            <div class="modal-content">
                <div id="queryStep1">
                    <label>é€‰æ‹©æŸ¥è¯¢é€‰æ‰‹ï¼š</label>
                    <div id="queryStudentList" class="select-list" style="max-height:300px;"></div>
                </div>
                <div id="queryStep2" style="display:none;">
                    <div style="background:#1e293b; padding:20px; border-radius:20px; color:white; text-align:center; margin-bottom:20px;">
                        <h2 id="qName">---</h2>
                        <div style="display:flex; justify-content:space-around;">
                            <div><small>æ’å</small><div id="qRank" style="font-size:20px; font-weight:900;">--</div></div>
                            <div><small>ç§¯åˆ†</small><div id="qPts" style="font-size:20px; font-weight:900; color:#fbbf24;">0</div></div>
                        </div>
                    </div>
                    <label>å˜åŠ¨æ˜ç»†ï¼š</label>
                    <div id="qHistory" style="max-height:250px; overflow-y:auto; background:#f8fafc; padding:10px; border-radius:15px;"></div>
                    <button class="btn-submit" style="background:#64748b; margin-top:15px;" onclick="backToQueryList()">è¿”å›é‡é€‰</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="resultModal" class="modal-mask" style="align-items: center; justify-content: center;">
        <div class="modal-body" style="max-width: 320px; border-radius: 35px; text-align: center; padding: 40px 20px;">
            <div style="width: 80px; height: 80px; background: #f0fdf4; color: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 25px;"><i class="fas fa-check-circle"></i></div>
            <h3 style="margin: 0; font-size: 22px; font-weight: 950;">æäº¤æˆåŠŸï¼</h3>
            <p style="margin: 10px 0 30px; color: #64748b;">ç”³è¯·å·²è¿›å…¥å®¡æ ¸é˜Ÿåˆ—</p>
            <button class="btn-submit" onclick="closeResultPopup()">å¥½çš„</button>
        </div>
    </div>

    <!-- ç¡®è®¤æ¨¡æ€æ¡† (ç¾åŒ–ç‰ˆ confirm) -->
    <div id="confirmModal" class="modal-mask" style="align-items: center; justify-content: center; z-index: 2000; background: rgba(0,0,0,0.3);">
        <div class="modal-body" style="max-width: 320px; border-radius: 30px; padding: 30px 25px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div style="width: 60px; height: 60px; background: #eff6ff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 20px;"><i class="fas fa-question"></i></div>
            <h3 style="margin: 0 0 10px; font-weight: 900; font-size: 20px;">ç¡®è®¤æäº¤ï¼Ÿ</h3>
            <p id="confirmMsg" style="color: #64748b; font-size: 14px; margin-bottom: 25px; line-height: 1.6;">...</p>
            <div style="display: flex; gap: 10px;">
                <button onclick="closeConfirmModal()" style="flex: 1; padding: 12px; border: none; background: #f1f5f9; color: #64748b; font-weight: 800; border-radius: 12px; cursor: pointer;">å–æ¶ˆ</button>
                <button onclick="executeSubmission()" style="flex: 1; padding: 12px; border: none; background: var(--primary); color: white; font-weight: 800; border-radius: 12px; cursor: pointer;">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let students = [], groups = [], currentArea = '', currentTab = 'student', selectedIds = new Set();
        let currentStandardData = [];
        let pendingSubmission = null; // æš‚å­˜å¾…æäº¤çš„æ•°æ®

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('applyDate').value = new Date().toISOString().split('T')[0];
            initData();
        });

        async function initData() {
            try {
                const [sRes, gRes, groupRankRes, bountyRes] = await Promise.all([
                    fetch('/api/students'), fetch('/api/groups'), fetch('/api/ranking?type=group'), fetch('/api/bounties/progress')
                ]);
                students = await sRes.json();
                groups = await gRes.json();
                const groupData = await groupRankRes.json();
                document.getElementById('groupProgressList').innerHTML = groupData.map(g => `
                    <div class="group-block" style="border-top-color:${g.color || '#4f46e5'}">
                        <div>${g.name}</div>
                        <div>${g.points} PTS</div>
                    </div>`).join('');

                const bData = await bountyRes.json();
                document.getElementById('bountyListContainer').innerHTML = bData.map(b => `
                    <div class="bounty-card">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <div style="font-weight:900; font-size:18px;">${b.reward_name}</div>
                            <div style="font-size:12px; color:#ef4444; font-weight:900; background:#fff1f2; padding:2px 8px; border-radius:5px;">${b.end_date||'é•¿æœŸ'}</div>
                        </div>
                        <div style="font-size:13px; color:#64748b; margin-bottom:15px;">${b.description||'æŒ‘æˆ˜ä»»åŠ¡'}</div>
                        <div>
                            ${b.leaders.map((l, i) => `<div class="leader-item"><span>${i+1}. ${l.name}</span><span>${l.points}/${b.target_points}</span></div>`).join('') || '<div style="text-align:center; color:#ccc;">è™šä½ä»¥å¾…</div>'}
                        </div>
                    </div>`).join('') || '<div style="grid-column:1/-1; text-align:center; color:#ccc; padding:30px;">æš‚æ— æ´»è·ƒæ‚¬èµ</div>';
            } catch(e) { console.error(e); }
        }

        function renderTargetList() {
            const container = document.getElementById('targetList');
            const data = (currentTab === 'student') ? students : groups;
            container.innerHTML = data.map(item => `<div class="list-item ${selectedIds.has(item.id)?'selected':''}" onclick="toggleSelect(${item.id})">${item.name}</div>`).join('');
        }
        function toggleSelect(id) { if(selectedIds.has(id)) selectedIds.delete(id); else selectedIds.add(id); renderTargetList(); }
        function switchTab(t) { 
            currentTab = t; selectedIds.clear(); 
            document.getElementById('tabStu').style.background = t==='student'?'#eef2ff':'transparent';
            document.getElementById('tabGrp').style.background = t==='group'?'#eef2ff':'transparent';
            renderTargetList(); 
        }
        async function openApplyModal(area) {
            currentArea = area; selectedIds.clear();
            document.getElementById('modalTitle').innerText = area + 'ç”³æŠ¥';
            document.getElementById('applyModal').style.display = 'flex';
            
            // ç»Ÿä¸€é€»è¾‘ï¼šæ— è®ºæ˜¯è‡ªå®šä¹‰è¿˜æ˜¯å…¶ä»–ï¼Œéƒ½ä»åç«¯åŠ è½½é…ç½®
            const res = await fetch(`/api/point_standards?area=${encodeURIComponent(area)}`);
            currentStandardData = await res.json();
            const cats = [...new Set(currentStandardData.map(d => d.category))];
            
            if (cats.length === 0) {
                // å¦‚æœåç«¯æ²¡æœ‰é…ç½®è¯¥åˆ†ç±»çš„æ•°æ®ï¼ˆä¾‹å¦‚æ•°æ®åº“ä¸ºç©ºï¼‰ï¼Œç»™ä¸ªæç¤º
                document.getElementById('catSelect').innerHTML = '<option value="">æš‚æ— é…ç½®</option>';
                document.getElementById('itemSelect').innerHTML = '';
            } else {
                document.getElementById('catSelect').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
                loadItems();
            }
            renderTargetList();
        }
        function loadItems() {
            const cat = document.getElementById('catSelect').value;
            const filtered = currentStandardData.filter(s => s.category === cat);
            document.getElementById('itemSelect').innerHTML = filtered.map(d => `<option value="${d.name}" data-pts="${d.default_points}">${d.name} (${d.default_points>0?'+':''}${d.default_points})</option>`).join('');
        }
        function quickFill(name, el) { 
            document.getElementById('submitterName').value = name; 
            document.querySelectorAll('.role-tag').forEach(t => t.classList.remove('active')); 
            el.classList.add('active'); 
        }
        
        async function submitApply() {
            const subName = document.getElementById('submitterName').value;
            if(!subName) return showToast('è¯·å¡«å†™ç”³æŠ¥äººå§“å');
            
            const selectEl = document.getElementById('itemSelect');
            if(!selectEl.value) return showToast('è¯·é€‰æ‹©å…·ä½“äº‹é¡¹');
            
            const opt = selectEl.selectedOptions[0];
            const pts = parseInt(opt.dataset.pts);
            const reason = `[${currentArea}/${document.getElementById('catSelect').value}] ${opt.value}`;

            let finalIds = [];
            if(currentTab === 'group') { selectedIds.forEach(gid => { finalIds = [...finalIds, ...students.filter(s => s.group_id === gid).map(s => s.id)]; }); } else { finalIds = Array.from(selectedIds); }
            
            // å‡†å¤‡æäº¤æ•°æ®
            pendingSubmission = {
                student_ids: finalIds,
                change_amount: pts,
                reason: reason,
                submitter: subName,
                created_at: document.getElementById('applyDate').value + ' 12:00:00'
            };

            // é€»è¾‘æ£€æŸ¥ä¸å¼¹çª—æç¤º
            const isBenchmarkArea = (currentArea === 'å­¦ä¸šç®¡ç†' || currentArea === 'ç­çº§ç®¡ç†');
            
            if (isBenchmarkArea && pts < 0) {
                if (finalIds.length === 0) {
                    showConfirmModal("æ‚¨æœªé€‰æ‹©ä»»ä½•æ‰£åˆ†å¯¹è±¡ã€‚<br><br><b>æ˜¯å¦ç¡®è®¤ã€å…¨ç­å‡å·²è¾¾æ ‡ã€‘ï¼Ÿ</b><br><br><span style='color:#10b981'>ç³»ç»Ÿå°†è‡ªåŠ¨ä¸ºå…¨å‘˜å‘æ”¾ +2 åˆ†å¥–åŠ±ã€‚</span>");
                    return;
                } else {
                    showConfirmModal(`æ‚¨é€‰æ‹©äº† <b>${finalIds.length}</b> ä½åŒå­¦è¿›è¡Œæ‰£åˆ†ã€‚<br><br><b>ç³»ç»Ÿå°†è‡ªåŠ¨ä¸ºã€å…¶ä»–æœªé€‰ä¸­ã€‘çš„åŒå­¦å‘æ”¾ +2 åˆ†è¾¾æ ‡å¥–åŠ±ã€‚</b><br><br>æ˜¯å¦ç¡®è®¤æäº¤ï¼Ÿ`);
                    return;
                }
            } else {
                if (finalIds.length === 0) return showToast('è¯·åœ¨åˆ—è¡¨ä¸­é€‰æ‹©ç”³æŠ¥å¯¹è±¡');
                // æ™®é€šæäº¤ç›´æ¥æ‰§è¡Œï¼Œä¸å¼¹çª—
                executeSubmission();
            }
        }

        function showConfirmModal(msg) {
            document.getElementById('confirmMsg').innerHTML = msg;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            pendingSubmission = null;
        }

        async function executeSubmission() {
            if (!pendingSubmission) return;
            // å…³é—­ç¡®è®¤æ¡†
            document.getElementById('confirmModal').style.display = 'none';
            
            try {
                const res = await fetch('/api/audit/submit', { 
                    method:'POST', 
                    headers:{'Content-Type':'application/json'}, 
                    body:JSON.stringify(pendingSubmission) 
                });
                
                if(res.ok) { 
                    closeApplyModal(); 
                    document.getElementById('resultModal').style.display = 'flex'; 
                } else { 
                    showToast('æäº¤å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'); 
                }
            } catch(e) {
                showToast('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        function closeApplyModal() { document.getElementById('applyModal').style.display='none'; }
        function closeResultPopup() { document.getElementById('resultModal').style.display='none'; }
        function openQueryModal() { document.getElementById('queryModal').style.display='flex'; document.getElementById('queryStep1').style.display='block'; document.getElementById('queryStep2').style.display='none'; document.getElementById('queryStudentList').innerHTML = students.map(s => `<div class="list-item" onclick="fetchStudentDetail(${s.id}, '${s.name}')">${s.name}</div>`).join(''); }
        async function fetchStudentDetail(sid, name) { const res = await fetch(`/api/students/${sid}/history`); const data = await res.json(); document.getElementById('queryStep1').style.display='none'; document.getElementById('queryStep2').style.display='block'; document.getElementById('qName').innerText = name; document.getElementById('qRank').innerText = data.rank; document.getElementById('qPts').innerText = data.points; document.getElementById('qHistory').innerHTML = data.history.map(h => `<div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee;"><small>${h.reason}</small><b style="color:${h.change_amount>0?'green':'red'}">${h.change_amount>0?'+':''}${h.change_amount}</b></div>`).join(''); }
        function backToQueryList() { document.getElementById('queryStep1').style.display='block'; document.getElementById('queryStep2').style.display='none'; }
        function closeQueryModal() { document.getElementById('queryModal').style.display='none'; }
        function showToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.style.display = 'block'; setTimeout(() => t.style.display='none', 2000); }
    </script>
</body>
</html>